name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out EV Binary cert signing GitHub Action
on: [push]
jobs:
  binary-sign:
    runs-on: ess_win
    steps:
      - run: echo "The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "This job is now running on a ${{ runner.os }} server hosted by ESS."
      - name: Check out repository code
        uses: actions/checkout@v3

      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}

      - name: Copy binary to workspace
        run: cp c:\\Windows\\notepad.exe ${{ github.workspace }}\\binary.exe

    #   - name: Sign binary
    #     uses: ess-dmsc-dram/code-sign-action@v1
    #     with:
    #       cert: ${{ secrets.EV_CERT }}
    #       cert-password: ${{ secrets.EV_CERT_PASSWORD }}
    #       binary: ${{ github.workspace }}/binary.exe
    #       output: ${{ github.workspace }}/binary-signed.exe

    #   - name: Sign binary
    #     steps:
    #         uses: DanaBear/code-sign-action@v4
    #         with:
    #         certificate: '${{ secrets.EV_CERT }}'
    #         password: '${{ secrets.EV_CERT_PASSWORD }}'
    #         #certificatesha1: '${{ secrets.CERTHASH }}'
    #         #certificatename: '${{ secrets.CERTNAME }}'
    #         binary: ${{ github.workspace }}/binary.exe
    #         output: ${{ github.workspace }}/binary-signed.exe

      - name: Sign binary
        shell: cmd
        run: |
            "C:\\Program Files (x86)\\Windows Kits\\10\\App Certification Kit\\signtool.exe" sign /tr http://timestamp.digicert.com /td sha256 /fd sha256 /sha1 ${{ secrets.sha1 }} ${{ github.workspace }}/binary.exe"


      - run: echo "This job's status is ${{ job.status }}."

